<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="login.css">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <!-- <script src="/login/login.js"></script> --> <!--dando erro na leitura do script quando ele esta em arquivo externo-->
</head>
<body>
   <div class="container">
       <div class="card">
              <h1>Entrar</h1>

              <div id="msgError"></div>

              <div class="label-float">
                     <input type="text" id="email" placeholder=""required>
                     <label id="emailLabel" for="usuario">Email</label>
              </div>

              <div class='label-float'>
                     <input type='password' id='senha' placeholder=''required>
                     <label id="senhaLabel" for='senha'>Senha</label>
                     <i class="fa fa-eye" aria-hidden="true"></i>
              </div>

              <div class='botaoEntrar'>
                     <button onclick="entrar()">Entrar</button>
              </div>
       
              <div>
                     <hr>
              </div>
       
              <p>Não é cliente?
                     <a href="/cadastro/cadastro.html">Cadastre-se</a>
              </p>

       </div>      
   </div>

   <script>
       //LOGICA BOTÃO DE VISUALIZAR A SENHA
       let btn = document.querySelector('.fa-eye')

       btn.addEventListener('click', ()=> {
       let inputSenha = document.querySelector('#senha')
  
       if(inputSenha.getAttribute('type') == 'password'){
        inputSenha.setAttribute('type', 'text')
       } else {
          inputSenha.setAttribute('type', 'password')
        }
       })

       //LOGICA PARA EFETUAR LOGIN
       function entrar(){
       let email = document.querySelector('#email')
       let emailLabel = document.querySelector('#emailLabel')

       let senha = document.querySelector('#senha')
       let senhaLabel = document.querySelector('#senhaLabel')

       let msgError = document.querySelector('#msgError')

       //LOGICA PARA CHAMAR A LISTA DE USER
       let listaUser = []
         
       //LOGICA PARA VALIDAÇÃO DE USER
       let userValid = {
       nome: '',
       email: '',
       telefone:'',
       senha:''
       }

       listaUser = JSON.parse(localStorage.getItem('listaUser'))

       listaUser.forEach((item) =>{
              if(email.value == item.emailCad && senha.value == item.senhaCad){
                    
                     userValid = {
                            nome: item.nomeCad,
                            email: item.emailCad,
                            telefone: item.telefoneCad,
                            senha: item.senhaCad
                     }
              }
       })

       if(email.value == userValid.email && senha.value == userValid.senha){
              window.location.href = 'http://127.0.0.1:5500/dashboard-crm/home.html'
       } else {
              emailLabel.setAttribute('style', 'color: red')
              email.setAttribute('style', 'border-color: red')
              senhaLabel.setAttribute('style', 'color: red')
              senha.setAttribute('style', 'border-color: red')
              msgError.setAttribute('style', 'display: block')
              msgError.innerHTML = 'Usuário ou senha incorretos'
              email.focus()//VOLTA PARA O CAMPO EMAIL CASO DE ERRO NA AUTENTICAÇÃO
       }

       }



   </script>
</body>
</html>